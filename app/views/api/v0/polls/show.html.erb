<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	
<style>
	.progress-bar {
  		overflow-x:visible;
  		white-space:nowrap;
  		color:black; /* color is for demo purposes */
	}
	.progress {
		height: 40px;
		font-size: 30px;
	}
	.bar {
		font-size: 15px;
		line-height: 30px;
	}

</style>
	
<script>
		
		var loadPolls = function(){

		$(".detail").css("pointer-events", "none");
		
		var poll_id = <%= @poll.id %> 
		var results = JSON.parse('<%= @vote_count_ar %>'.replace(/&quot;/g,'"'));
		var user_vote = '<%= @current_user_voted[0] %>' ; 
		var total_votes =  '<%= @users_voted.length %>';
		var user_flock_id = '<%= @guest_user %>';

		var url = '<%= ENV["POLL_URL"] %>'+'/api/v0/polls/'+poll_id;
		
		// var form = "<form action='"+url+"' method='PUT'>";

		var polls = "";

		for(var i=0;i<results.length;i++)
		{
			
			var option = "<div style='height:40px;'>"
			option +=    "<input type='radio' name='user_vote' style='float:left;margin-right:10px;margin-left:10px;height:30px' \
							value='"+ results[i][4]+"'>";
			option +=    "<a href='"+results[i][5]+"' target='_blank'>";
			option +=    "<div class='progress' style='width:300px;float:left;height:30px'>";
			if(user_vote==results[i][4])
			{
				option+="<div id='rest" + results[i][4] +"' class='bar progress-bar progress-bar-info' role='progressbar' style='width:"+  ( (total_votes==0)? 0 :(results[i][1]*100)/total_votes ) +"%;color:#000;height:30px'>";
			}
			else
			{
				option+="<div id='rest" + results[i][4] +"' class='bar progress-bar progress-bar-success bar' role='progressbar' style='width:"+  ( (total_votes==0)? 0 :(results[i][1]*100)/total_votes ) +"%;color:#000;height:30px'>";
			}

			option+="<span class='detail'> &nbsp;"+results[i][0] + " (" + results[i][1]+" votes)</span>";		
			option+="</div>";
			option+="</div>";
			option+="</a>";
			option+="</div>";
			polls+=option;
		}

		$('body').append(polls);


		$('input[type=radio][name=user_vote]').change(function(){
			console.log(this.value);
			$.post(url+"/restaurant/"+this.value,{user_id: user_flock_id},function(){
					console.log('done');
				}).fail(function(){
					console.log('not done');
				});		
		});
	};

</script>

<body onload='loadPolls()' style='margin-top: 15px;overflow-x:hidden;overflow-y: scroll'>
</body>

</html>